(function(){var a,b,c=[].slice,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;b=function(){function a(){}return a.extend=function(){var a,b,d,e,f,g;for(a=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],a=this.obj(a),d=0,e=b.length;e>d;d++)if(f=b[d],"object"==typeof f)for(g in f)a[g]=f[g];return a},a.obj=function(a,b){return"object"==typeof a?a:"object"==typeof b?b:{}},a.escapeRegex=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},a.prototype.$$arrayForEach=function(a,b){if(!Array.isArray(a))throw"$arrayForEach expects an array, given: "+typeof a;return a.length},a.prototype.$on=function(a,b){return null==this.__eventHandlers&&(this.__eventHandlers={}),null==this.__eventHandlers[a]&&(this.__eventHandlers[a]=[]),this.__eventHandlers[a].push(b)},a.prototype.$trigger=function(){var a,b,d,e,f,g,h;if(b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],null!=this.__eventHandlers&&null!=this.__eventHandlers[b]){for(f=this.__eventHandlers[b],g=[],d=0,e=f.length;e>d;d++)h=f[d],console.log("forwarding event",b),"function"==typeof h?g.push(h.apply(this,a)):g.push(void 0);return g}},a.prototype.$$interpolate=function(){var a;return a={"\n":"\\n",'"':'"',"\u2028":"\\u2028","\u2029":"\\u2029"},function(b){return new Function("o",'return "'+b.replace(/["\n\r\u2028\u2029]/g,function(b){return a[b]}).replace(/\{([\s\S]+?)\}/g,'" + o["$1"] + "')+'";')}}(),a}(),a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.$$apply=function(a,b){return this[a].apply(this,b)},b.prototype.$$call=function(){var a,b;return b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],this[b].apply(this,a)},b.prototype.$$setDefaults=function(a,b){var c,d;if("object"==typeof b)for(d in b)a[d]=b[d];c=[];for(d in a)c.push(this[d]=a[d]);return c},b}(b),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorBase=a,("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorUtil=b}).call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=function(a){function b(a){this.options=a}return c(b,a),b.prototype.save=function(a){var b,c;return c=a.state.snapshot(),b=new ConveyorBelt("publish",this.transformers,c),b.promise},b.prototype.$remove=function(){},b.prototype.$list=function(){},b.prototype.$create=function(){},b}(ConveyorBase),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorInterface=a}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=function(a){function b(a){this.$$setDefaults({_applier:null,models:{},_publisher:null}),a&&(a.onApply&&(this._applier=a.onApply),a.onPublish&&(this._publisher=a.onPublish))}return c(b,a),b.prototype.onApply=function(a){return this._applier=a,this},b.prototype.onPublish=function(a){return this._publisher=a,this},b.prototype.$apply=function(a,b){return this._applier?this._applier.call(b,a):b.next(a)},b.prototype.$publish=function(a,b){return this._publisher?this._publisher.call(b,a):b.next(a)},b}(ConveyorBase),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorTransformer=a}.call(this),function(){var a;a=function(){function a(a,b){this.$model=a,this.$$transformer=Conveyor.getTransformer(b),this.$apply()}return a.prototype.$$transformer=null,a.prototype.$dirty=!1,a.prototype.$apply=function(){var b;for(b in this.$model.fields)this[b]=this.$model.get(b),this[b]instanceof ConveyorModel&&(this[b]=new a(this[b]));return this.$$transformer&&ConveyorBelt.run(this,this.$$transformer,"apply"),this.$dirty=this.$model.$isDirty(),this},a.prototype.$commit=function(){var a;for(a in this)0!==a.indexOf("$")&&"constructor"!==a&&this.$model.set(a,this[a]);return this.$apply()},a.prototype.$save=function(a){return this.$commit(),this.$model.save(a).then(function(a){return function(){return a.$apply()}}(this))},a.prototype.$delete=function(){return this.$model.remove()},a.prototype.$reset=function(){return this.$model.reset(),this.$apply()},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorFacade=a}.call(this),function(){var a;a=function(){function a(a,b,c,d){var e,f,g,h;if(this.promise=new ConveyorPromise,this.data=a,this.extra=ConveyorUtil.obj(d),h=b instanceof Array&&b||[b],this.direction=c||"apply","publish"===this.direction){for(g=[],f=h.length-1;f>=0;f+=-1)e=h[f],g.push(e);h=g}this.transformers=h,this.pos=-1,this.status=-1,this.error=!1,this.warnings=[],this.next(this.data)}return a.prototype.next=function(a){return this.data=a,this.pos++,this.status=0,this.pos<this.transformers.length?this.transformers[this.pos]["$"+this.direction](this.data,this):(this.status=1,this.promise.resolve(a)),this},a.prototype.reject=function(a){return this.promise.reject(a)},a.prototype.skip=function(){return this.next(this.data)},a.prototype.warn=function(a){return this.warnings.push(a)},a.prototype.later=function(a){},a.prototype.inject=function(a){return this.transformers.splice(this.pos+1,0,a),this},a.prototype.append=function(a){return this.transformers.push(a),this},a.run=function(b,c,d,e){return new a(b,c,d,e).promise},a.thread=function(b,c,d){var e,f,g,h;for(h=[],f=0,g=b.length;g>f;f++)e=b[f],h.push(new a(e,c,d).promise);return ConveyorPromise.aggregate(h)},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorBelt=a}.call(this),function(){var a;a=function(){function a(){}return a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorConflict=a}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.transformers={},c.models={},c.interfaces={},c.registerTransformer=function(a,b,c){return this.transformers[a]=this.Transformer(b,c)},c.getTransformer=function(a){return"function"==typeof a?a:this.transformers[a]?this.transformers[a]:void 0},c.Transformer=function(a,b){var c;return c=new ConveyorTransformer,"function"==typeof a&&c.onApply(a),"function"==typeof b&&c.onPublish(b),c},c.prototype.registerModel=function(){},c.prototype.registerInterface=function(){},c}(ConveyorBase),("undefined"!=typeof exports&&null!==exports?exports:this).Conveyor=("undefined"!=typeof exports&&null!==exports?exports:this).CV=a}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(ConveyorFacade),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorAngularFacade=a}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a){this.$$setDefaults({endpoint:null,endpointExt:null,actions:[],transformers:[],listTransformers:[]},a)}return b(c,a),c.prototype.fetch=function(){},c.prototype.remove=function(a,b){var c,d,e;return e=new ConveyorPromise,c=ConveyorUtil.extend({},a,b.params),d=this.$$path("remove")(c),this.$$req("delete",d).then(function(a){return function(a){return e.resolve(a)}}(this),function(a,b,c){return e.reject(c)}),e},c.prototype.list=function(a){var b,c;return a=ConveyorUtil.obj(a),c=new ConveyorPromise,b=this.$$path("list")(ConveyorUtil.obj(a.params)),this.$$req("get",b,ConveyorUtil.obj(a.data),a.queue||null).then(function(a){return function(b){return ConveyorBelt.run(b,a.listTransformers,"apply").then(function(d){if(d instanceof Array)return ConveyorBelt.thread(b,a.transformers,"apply").then(c);throw"list must be array"},c.reject)}}(this),function(a,b,d){return c.reject(d)}),c},c.prototype.save=function(a,b){var c;return c=new ConveyorPromise,ConveyorBelt.run(a,this.transformers,"publish",b).then(function(a){return function(d){var e,f;return e=ConveyorUtil.extend({},d,b.params),f=a.$$path("save",b.custom_path&&b.custom_path||!1)(e),a.$$req("put",f,d).then(function(b){return ConveyorBelt.run(b,a.transformers,"apply").then(c)},function(a,b,d){return c.reject(d)})}}(this),function(a){return c.reject(a)}),c},c.prototype.create=function(a,b){var c;return c=new ConveyorPromise,ConveyorBelt.run(a,this.transformers,"publish").then(function(a){return function(d){var e,f;return e=ConveyorUtil.extend({},d,b.params),f=a.$$path("create")(e),a.$$req("post",f,d).then(function(b){return ConveyorBelt.run(b,a.transformers,"apply").then(c)},function(a,b,d){return c.reject(d)})}}(this),function(a){return c.reject(a)}),c},c.prototype.$$path=function(a,b){var c;if(c="",b&&0!==b.indexOf("./"))return this.$$interpolate(b);if("object"==typeof this.endpoint)if(null!=this.endpoint[a])c=this.endpoint[a];else if(-1!==["remove","save"].indexOf(this.endpoint[a])&&null!=this.endpoint.fetch)c=this.endpoint.fetch;else{if("create"!==a||null==this.endpoint.list)throw"No valid endpoint for "+a+".";c=this.endpoint.list}else{if("string"!=typeof this.endpoint)throw"No valid endpoint for "+a+".";c=-1!==["list","create"].indexOf(a)?this.endpoint:this.endpoint+"/{id}"}return b&&0===b.indexOf("./")&&(c+=b.substr(1)),null!=this.endpointExt&&"string"==typeof this.endpointExt&&(c+=this.endpointExt),this.$$interpolate(c)},c.prototype.queue_index=0,c.prototype.queues={},c.prototype.$$req=function(a,b,c,d){var e,f,g;if(e=$.ajax({url:b,method:a,data:"get"!==a&&JSON.stringify(c)||c,contentType:"application/json",dataType:"json"}),console.info("req",a,b,c,d),null!=d&&"object"==typeof d){if(null==this.queues[d.id]&&(this.queues[d.id]={length:0}),d.abort)for(g in this.queues[d.id])"length"!==g&&(console.error("aborting",this.queues[d.id],g,d.id),this.queues[d.id][g].abort());f=this.queue_index++,this.queues[d.id][f]=e,console.info("starting",this.queues[d.id][f],f,d.id),this.queues[d.id].length++,e.always(function(a){return function(){return console.warn("completing",a.queues[d.id][f],f,d.id),null!=a.queues[d.id][f]?(a.queues[d.id].length--,delete a.queues[d.id][f]):void 0}}(this))}return e},c}(ConveyorInterface),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorHttpInterface=a}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty,e=[].slice;a=function(a){function b(a,b){this._ref=this.constructor._refCount++,this.data={},this.conf=ConveyorUtil.obj(b),this.interfaces={},this.sync(a)}return c(b,a),b._refCount=0,b.facade=ConveyorFacade,b.prototype.deleted=!1,b.prototype.save=function(a){var b,c,d;return null!=(null!=a?a.tmp:void 0)?(d=ConveyorUtil.obj(a.tmp),delete a.tmp):d={},a=ConveyorUtil.extend({},this.conf,a),c=ConveyorUtil.extend({},a,d),b=this.$publish(a.changed_only&&!0||!1),this.getPrimaryKey()?this.allInterfaces("save",b,c).then(function(b){return function(c){return b.sync(c[0],a)}}(this)):this.allInterfaces("create",b,c).then(function(b){return function(c){return b.sync(c[0],a)}}(this))},b.prototype.remove=function(a){var b;if(a=ConveyorUtil.extend({},this.conf,a),b=this.$publish(a.changed_only&&!0||!1),this.getPrimaryKey())return this.allInterfaces("remove",b,a).then(function(a){return function(b){return a.deleted=!0}}(this));throw"no primary key, can't delete"},b.prototype.getPrimaryKey=function(){return this.get(this.constructor.primaryKey)},b.list=function(a,b){var c,d;return"object"!=typeof b&&(b={}),b.data=a,null!=b.tmp?(d=ConveyorUtil.obj(b.tmp),delete b.tmp):d={},c=ConveyorUtil.extend({},b,d),this.firstInterface("list",c).then(function(a){return function(c){var d,e,f,g,h;for(h=[],f=0,g=c.length;g>f;f++)e=c[f],h.push(a.sync(e,b));return d=a._collectionize(h)}}(this))},b.get=function(a,b){var c;return c=new ConveyorPromise,"object"==typeof a?c.resolve(this.sync(data,b)):"number"==typeof a?this.index[this.name+"_"+a]?c.resolve(this.index[this.name+"_"+a]):(b=ConveyorUtil.obj(b),b.params=ConveyorUtil.obj(b.params),b.params.id=a,this.firstInterface("fetch",b).then(function(a){return function(d){return c.resolve(a.sync(d,b))}}(this),function(a){return c.reject(a)})):c.reject("invalid model ref"),c},b.sync=function(a,b){var c;if(c=a[this.primaryKey],!c)throw"You can only sync models with a primary key.";return null==this.index[this.name+"_"+c]?this.index[this.name+"_"+c]=new this.$self(a,b):this.index[this.name+"_"+c].sync(a)},b.prototype.sync=function(a,b){var c,d,e,f;a=ConveyorUtil.obj(a),ConveyorUtil.extend(this.conf,b),d=null!=a[this.constructor.primaryKey];for(e in this.fields)c=this.fields[e],null!=a[e]&&(f=a[e],null!=this.data[e]&&this.data[e]instanceof ConveyorValueCore?this.data[e].set(f,!0):null!=(null!=c?c.type:void 0)&&(c.type instanceof ConveyorValueCore?this.data[e]=new c.type(f,e,this,c,d):null!=ConveyorValue[c.type]?this.data[e]=new ConveyorValue[c.type](f,e,this,c,d):console.error("ConveyorModelValue::"+c.type+" is not a valid value type.")),null==this.data[e]&&console.warn("ConveyorModel::constructor ignoring key: ",e,a[e]));return this},b.prototype.$publish=function(a){var b,c;null==a&&(a=!1),c={};for(b in this.data)a?this.data[b].dirty&&(c[b]=this.data[b].$publish()):c[b]=this.data[b].$publish();return c},b.prototype.get=function(a){return this.data[a]?this.data[a].get():null},b.prototype.set=function(a,b,c){var d;return null==c&&(c=!1),this.data[a]?this.data[a].set(b,c):null!=this.fields[a]?(d=this.fields[a],d.type instanceof ConveyorValueCore?this.data[a]=new d.type(b,a,this,d,c):null!=ConveyorValue[d.type]?this.data[a]=new ConveyorValue[d.type](b,a,this,d,c):console.error("ConveyorModelValue::"+d.type+" is not a valid value type.")):void 0},b.prototype.$facade=function(a){return new this.constructor.facade(this,a)},b.prototype.$isDirty=function(){var a;for(a in this.data)if(this.data[a].dirty)return!0;return!1},b.prototype.reset=function(){var a,b;b=[];for(a in this.data)this.data[a].dirty?b.push(this.data[a].reset()):b.push(void 0);return b},b._collectionize=function(a){var b,c;return a.$changed=function(){return this.filter(function(a){return a.dirty})},c=[],b=this,a.$facade=function(a){var d,e,f;for(c=[],e=0,f=this.length;f>e;e++)d=this[e],c.push(new b.facade(d,a));return c},a},b.create=function(a){},b.addInterface=function(a,b){return this.interfaces[a]=b},b.prototype.addInterface=function(a,b){return this.constructor.interfaces[a]=b},b.prototype.allInterfaces=function(){var a,b,c,d,f,g;b=arguments[0],d=2<=arguments.length?e.call(arguments,1):[],f=ConveyorUtil.obj(this.constructor.interfaces),c=[];for(g in f)a=f[g],-1!==a.actions.indexOf(b)&&c.push(a.$$apply(b,d));if(!c.length)throw"No interface available with the ability to: "+b;return ConveyorPromise.aggregate(c)},b.firstInterface=function(){var a,b,c,d;b=arguments[0],c=2<=arguments.length?e.call(arguments,1):[];for(d in this.interfaces)if(a=this.interfaces[d],-1!==a.actions.indexOf(b))return a.$$apply(b,c);throw"No interface available with the ability to: "+b},b.prototype.fields={},b.primaryKey="id",b.index={},b}(ConveyorBase),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorModel=a}.call(this),function(){var a,b;a=function(){function a(a){this.changed=!1,this.timestamp=Date.now()}return a.prototype.undo=function(){},a}(),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorModelState=a}.call(this),function(){var a,b,c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;c=function(){function b(a,b,c,d,e){this.key=b,this.model=c,this.conf=d,null==e&&(e=!0),this.conf.immutable&&(this.immutable=!0),null!=this.conf.nullable&&(this.nullable=this.conf.nullable),void 0!==this.conf.empty_value&&(this.empty_value=this.conf.empty_value),this.current=null,this.dirty=!1,this.saved=!1,this.errors=[],this.history=[],this.$apply(a,e).then(function(a){return function(){return"function"==typeof a.$init?a.$init():void 0}}(this))}return b.transformers=[],b.prototype.$init=null,b.prototype.immutable=!1,b.prototype.forced=!1,b.prototype.nullable=!0,b.prototype.empty_value=null,b.prototype.get=function(){return this.current},b.prototype.set=function(a,b){return null==b&&(b=!1),this.$apply(a,b)},b.prototype.reset=function(){return this.dirty&&this.history.length>1&&this.forced?this.$apply(this.history[0],!0):this.$apply(null,!0)},b.prototype.undo=function(){return this.dirty&&this.history.length>1?this.$apply(this.history[this.history.length-1],!0):void 0},b.onApply=function(a){var b;return b=Conveyor.Transformer(a),this.transformers.length?this.transformers.push(b):this.transformers=[b]},b.onPublish=function(a){var b;return b=Conveyor.Transformer(null,a),this.transformers.length?this.transformers.push(b):this.transformers=[b]},b.prototype.$apply=function(a,c){var d,e;if(null==c&&(c=!1),this.immutable&&!c&&this.history.length)return ConveyorPromise.reject();if(c&&(this.forced=!0),null===a)if(this.nullable||null===this.empty_value){if(!this.nullable)throw this.key+" cannot be set to null"}else a=this.empty_value;return this.raw=a,e=this.current,d=function(a){return function(d){return d instanceof b?a.current=d.raw:a.current=d,c||a.current===e||(a.dirty=!0,a.history.push(e),a.model.$trigger("change:"+a.key,a)),c&&(a.dirty=!1,a.history=[],a.model.$trigger("change:"+a.key,a)),a}}(this),null===a?ConveyorPromise.resolve(d(null)):ConveyorBelt.run(this,this.constructor.transformers,"apply").then(d,function(a){return this.exception(a)})},b.prototype.$publish=function(){var a;return a=null,ConveyorBelt.run(this,this.constructor.transformers,"publish").then(function(c){return a=c instanceof b?c.current:c},function(a){return this.exception(a)}),a},b.prototype.exception=function(b){throw console.error(b),new a(b,this)},b}(),b={},b.String=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.empty_value="",b.onApply(function(a){return"string"==typeof a.raw?this.next(a.raw):a.raw?"boolean"==typeof a.raw?this.next(a.raw&&(a.conf.boolTrue||"1")||a.conf.boolFalse||"0"):null!=a.raw.toString?this.next(a.raw.toString()):a.exception("ConveyorValue.String - Cannot convert value to string."):this.next("")}),b}(c),b.Number=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.empty_value=0,b.onApply(function(a){return"boolean"==typeof a.raw?this.next(a.raw&&1||0):"string"==typeof a.raw?0===a.raw.length?this.next(0):(a.raw.match(/[^0-9$%#,.\s\r\n]/g)&&a.raw.exception("Cannot convert `"+a.raw+"` to a number."),this.next(parseFloat(a.raw.replace(/[^0-9\.]/g,"")))):a.raw instanceof b||"number"==typeof a.raw?this.next(a.raw):a.exception("Cannot convert `"+a.raw+"` to a number.")}),b}(c),b.Currency=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.empty_value=0,b.onApply(function(a){return"string"==typeof a.raw?0===a.raw.length?this.next(0):(a.raw.match(/[^0-9$%#,.\s\r\n]/g)&&a.raw.exception("Cannot convert `"+a.raw+"` to a number."),this.next(parseFloat(a.raw.replace(/[^0-9\.]/g,"")))):a.raw instanceof Number||"number"==typeof a.raw?this.next(a.raw):a.exception("Cannot convert `"+a.raw+"` to a number.")}),b}(c),b.Boolean=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.empty_value=!1,b.onApply(function(a){if("boolean"==typeof a.raw)return this.next(a.raw);if("string"==typeof a.raw){if(-1!==["yes","true","1"].indexOf(a.raw))return this.next(!0);if(-1!==["no","false","0"].indexOf(a.raw))return this.next(!1)}return"number"==typeof a.raw?this.next(0!==a.raw&&!0||!1):a.exception("Cannot convert `"+a.raw+"` to a boolean.")}),b}(c),b.Raw=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b}(c),b.Model=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.immutable=!0,b.prototype.$init=function(){return this.conf.on?this.model.$on("change:"+this.conf.on,function(a){return function(b){return a.$apply(b.get(),!0)}}(this)):void 0},b.onApply(function(a,b){var c,d;return a.conf.on&&(d=a.model.get(a.conf.on)),"object"==typeof a.raw?(c=a.conf.model.sync(a.raw),a.conf.on&&!d&&a.model.set(a.conf.on,c.getPrimaryKey()),this.next(c)):"number"==typeof a.raw?a.current instanceof ConveyorModel?a.current.getPrimaryKey()!==a.raw?void a.conf.model.get(a.raw).then(function(a){return function(b){return console.warn(b),a.next(b)}}(this),function(a){throw a}):this.next(a.current):void a.conf.model.get(a.raw).then(function(a){return function(b){return a.next(b)}}(this),function(a){throw a}):this.next(a.raw)}),b.onPublish(function(a){return a.current instanceof ConveyorModel?this.next(a.current.getPrimaryKey()):this.next(a.current)}),b}(c),a=function(){function a(a,b){this.message=a,this.value=b}return a}(),d="undefined"!=typeof exports&&null!==exports?exports:window,d.ConveyorValueCore=c,d.ConveyorValue=b}.call(this),function(){var a;a=function(){function a(a,b){this._ref=this.constructor.index++,"function"==typeof a?this.executor=a:this.executor=null,this.resolvers=[],this.rejecters=[],this.$list=[],this.next=null,this.status=0,this.value=null,b||"function"!=typeof a||this.run()}return a.index=0,a.prototype.then=function(b,c){var d,e;return b instanceof a&&(e=b,c=function(a){return e.reject(a)},b=function(a){return e.resolve(a)}),0===this.status?(d=new a,b&&(b.$promise=d,this.resolvers.push(b)),c&&(c.$promise=d,this.rejecters.push(c)),d):1===this.status&&b?this._next(b.call(this,this.value)):-1===this.status&&c?this._next(c.call(this,this.value)):this},a.prototype["catch"]=function(a){return-1===this.status&&a&&a.call(this,value),a&&this.rejecters.push(a),this},a.resolve=function(b){var c;return c=new a,c.status=1,c.value=b,c},a.reject=function(b){var c;return c=new a,c.status=-1,c.value=b,c},a.prototype.resolve=function(a){var b,c,d,e,f;if(0!==this.status)throw console.error("test"),"This promise is already "+(-1===this.status&&"rejected"||"resolved")+". Cannot resolve.";for(this.value=a,this.status=1,f=this.resolvers,c=0,d=f.length;d>c;c++)b=f[c],e=b.call(this,a),null!=b.$promise&&b.$promise._forward(e);return this},a.prototype.reject=function(a){var b,c,d,e,f;if(0!==this.status)throw"This promise is already "+(-1===this.status&&"rejected"||"resolved")+". Cannot reject.";for(this.value=a,this.status=-1,f=this.rejecters,c=0,d=f.length;d>c;c++)b=f[c],e=b.call(this,a),null!=b.$promise&&b.$promise._forward(e);return this},a.prototype.run=function(a){if("function"==typeof executor&&(this.executor=executor),"function"!=typeof this.executor)throw"You can only call run on a promise if an executor is provided.";return this.executor.call(this,this.resolve,this.reject)},a.aggregate=function(b,c){var d,e,f,g,h,i,j,k,l,m;for(null==c&&(c=!1),d=new a,f=0,m=b.length,g=[],i=function(){return f++,f===m?e():void 0},e=function(){var a,e,f,g,h,i;for(h=[],a=[],e=f=0,g=b.length;g>f;e=++f)i=b[e],1===i.status?h.push(i.value):a.push(i.value);return a.length&&!h.length?d.reject(a):a.length&&c?d.reject(a):d.resolve(h)},h=j=0,k=b.length;k>j;h=++j)l=b[h],l.then(i,i);return 0===b.length&&e(),d},a.prototype._forward=function(b){return b instanceof a?b.then(function(a){return function(b){return a.resolve(b)}}(this),function(a){return function(b){return a.reject(b)}}(this)):this.resolve(b)},a.prototype._next=function(b){return b instanceof a?b:a.resolve(b)},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorPromise=a}.call(this);