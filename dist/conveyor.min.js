(function(){var a,b,c=[].slice,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;b=function(){function a(){}return a.extend=function(){var a,b,d,e,f,g;for(a=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],a=this.obj(a),d=0,e=b.length;e>d;d++)if(f=b[d],"object"==typeof f)for(g in f)a[g]=f[g];return a},a.obj=function(a,b){return"object"==typeof a?a:"object"==typeof b?b:{}},a.prototype.$$arrayForEach=function(a,b){if(!Array.isArray(a))throw"$arrayForEach expects an array, given: "+typeof a;return a.length},a.prototype.$on=function(a,b){return null==this.__eventHandlers&&(this.__eventHandlers={}),null==this.__eventHandlers[a]&&(this.__eventHandlers[a]=[]),this.__eventHandlers[a].push(b)},a.prototype.$trigger=function(){var a,b,d,e,f,g,h;if(b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],null!=this.__eventHandlers&&null!=this.__eventHandlers[b]){for(f=this.__eventHandlers[b],g=[],d=0,e=f.length;e>d;d++)h=f[d],"function"==typeof h?g.push(h.apply(this,a)):g.push(void 0);return g}},a.prototype.$$interpolate=function(){var a;return a={"\n":"\\n",'"':'"',"\u2028":"\\u2028","\u2029":"\\u2029"},function(b){return new Function("o",'return "'+b.replace(/["\n\r\u2028\u2029]/g,function(b){return a[b]}).replace(/\{([\s\S]+?)\}/g,'" + o["$1"] + "')+'";')}}(),a}(),a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.$$apply=function(a,b){return this[a].apply(this,b)},b.prototype.$$call=function(){var a,b;return b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],this[b].apply(this,a)},b.prototype.$$setDefaults=function(a,b){var c,d;if("object"==typeof b)for(d in b)a[d]=b[d];c=[];for(d in a)c.push(this[d]=a[d]);return c},b}(b),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorBase=a,("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorUtil=b}).call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=function(a){function b(a){this.options=a}return c(b,a),b.prototype.save=function(a){var b,c;return c=a.state.snapshot(),b=new ConveyorBelt("publish",this.transformers,c),b.promise},b.prototype.$remove=function(){},b.prototype.$list=function(){},b.prototype.$create=function(){},b}(ConveyorBase),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorInterface=a}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=function(a){function b(a){this.$$setDefaults({_applier:null,models:{},_publisher:null}),a&&(a.onApply&&(this._applier=a.onApply),a.onPublish&&(this._publisher=a.onPublish))}return c(b,a),b.prototype.onApply=function(a){return this._applier=a,this},b.prototype.onPublish=function(a){return this._publisher=a,this},b.prototype.$apply=function(a,b){return this._applier?this._applier.call(b,a):b.next(a)},b.prototype.$publish=function(a,b){return this._publisher?this._publisher.call(b,a):b.next(a)},b}(ConveyorBase),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorTransformer=a}.call(this),function(){var a;a=function(){function a(a,b){this.$model=a,this.$$transformer=Conveyor.getTransformer(b),this.$$apply()}return a.prototype.$$transformer=null,a.prototype.$$apply=function(){var b;for(b in this.$model.data)this[b]=this.$model.get(b),this[b]instanceof ConveyorModel&&(this[b]=new a(this[b]));return this.$$transformer&&ConveyorBelt.run(this,this.$$transformer,"apply"),this},a.prototype.$commit=function(){var a,b;b=[];for(a in this)0!==a.indexOf("$")&&b.push(this.$model.set(a,this[a]));return b},a.prototype.$save=function(a){return this.$commit(),this.$model.save(a).then(function(a){return function(){return a.$$apply()}}(this))},a.prototype.$delete=function(){return this.$model.remove()},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorFacade=a}.call(this),function(){var a;a=function(){function a(a,b,c){this.promise=new ConveyorPromise,this.data=a,this.transformers=b instanceof Array&&b||[b],this.direction=c||"apply",this.pos=-1,this.status=-1,this.error=!1,this.warnings=[],this.next(this.data)}return a.prototype.next=function(a){return this.data=a,this.pos++,this.status=0,this.pos<this.transformers.length?this.transformers[this.pos]["$"+this.direction](this.data,this):(this.status=1,this.promise.resolve(a)),this},a.prototype.reject=function(a){return this.promise.reject(a)},a.prototype.skip=function(){return this.next(this.data)},a.prototype.warn=function(a){return this.warnings.push(a)},a.prototype.later=function(a){},a.prototype.inject=function(a){return this.transformers.splice(this.pos+1,0,a),this},a.prototype.append=function(a){return this.transformers.push(a),this},a.run=function(b,c,d){return new a(b,c,d).promise},a.thread=function(b,c,d){var e,f,g,h;for(h=[],f=0,g=b.length;g>f;f++)e=b[f],h.push(new a(e,c,d).promise);return ConveyorPromise.aggregate(h)},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorBelt=a}.call(this),function(){var a;a=function(){function a(){}return a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorConflict=a}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.transformers={},c.models={},c.interfaces={},c.registerTransformer=function(a,b,c){return this.transformers[a]=this.Transformer(b,c)},c.getTransformer=function(a){return"function"==typeof a?a:this.transformers[a]?this.transformers[a]:void 0},c.Transformer=function(a,b){var c;return c=new ConveyorTransformer,"function"==typeof a&&c.onApply(a),"function"==typeof b&&c.onPublish(b),c},c.prototype.registerModel=function(){},c.prototype.registerInterface=function(){},c}(ConveyorBase),("undefined"!=typeof exports&&null!==exports?exports:this).Conveyor=("undefined"!=typeof exports&&null!==exports?exports:this).CV=a}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(ConveyorFacade),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorAngularFacade=a}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a){this.$$setDefaults({endpoint:null,endpointExt:null,actions:[],transformers:[],listTransformers:[]},a)}return b(c,a),c.prototype.fetch=function(){},c.prototype.remove=function(){},c.prototype.list=function(a){var b,c;return a=ConveyorUtil.obj(a),c=new ConveyorPromise,b=this.$$path("list")(ConveyorUtil.obj(a.params)),this.$$req("get",b,ConveyorUtil.obj(a.data)).then(function(a){return function(b){return ConveyorBelt.run(b,a.listTransformers,"apply").then(function(d){if(d instanceof Array)return ConveyorBelt.thread(b,a.transformers,"apply").then(c);throw"list must be array"},c.reject)}}(this),function(a,b,d){return c.reject(d)}),c},c.prototype.save=function(a,b){var c;return c=new ConveyorPromise,ConveyorBelt.run(a,this.transformers,"publish").then(function(a){return function(d){var e,f;return e=ConveyorUtil.extend({},d,b.params),f=a.$$path("save")(e),console.info(d),a.$$req("put",f,d).then(function(b){return console.info("saved",b),ConveyorBelt.run(b,a.transformers,"apply").then(c)},function(a,b,d){return c.reject(d)})}}(this),function(a){return c.reject(a)}),c},c.prototype.create=function(a,b){var c;return c=new ConveyorPromise,ConveyorBelt.run(a,this.transformers,"publish").then(function(a){return function(d){var e,f;return e=ConveyorUtil.extend({},d,b.params),f=a.$$path("create")(e),console.info("creating with",d),a.$$req("post",f,d).then(function(b){return ConveyorBelt.run(b,a.transformers,"apply").then(c)},function(a,b,d){return c.reject(d)})}}(this),function(a){return c.reject(a)}),c},c.prototype.$$path=function(a){var b;if(b="","object"==typeof this.endpoint)if(null!=this.endpoint[a])b=this.endpoint[a];else if(-1!==["remove","save"].indexOf(this.endpoint[a])&&null!=this.endpoint.fetch)b=this.endpoint.fetch;else{if("create"!==a||null==this.endpoint.list)throw"No valid endpoint for "+a+".";b=this.endpoint.list}else{if("string"!=typeof this.endpoint)throw"No valid endpoint for "+a+".";b=-1!==["list","create"].indexOf(a)?this.endpoint:this.endpoint+"/{id}"}return null!=this.endpointExt&&"string"==typeof this.endpointExt&&(b+=this.endpointExt),this.$$interpolate(b)},c.prototype.$$req=function(a,b,c){return $.ajax({url:b,method:a,data:"get"!==a&&JSON.stringify(c)||c,contentType:"application/json",dataType:"json"})},c}(ConveyorInterface),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorHttpInterface=a}.call(this),function(){var a,b,c=[].slice;a=function(){function a(a,b){this._ref=this.constructor._refCount++,this.data={},this.conf=ConveyorUtil.obj(b),this.interfaces={},this.sync(a)}return a._refCount=0,a.prototype.save=function(a){var b;return a=ConveyorUtil.extend({},this.conf,a),b=this.$publish(a.changed_only&&!0||!1),this.getPrimaryKey()?this.allInterfaces("save",b,a).then(function(a){return function(b){return a.sync(b)}}(this)):this.allInterfaces("create",b,a).then(function(a){return function(b){return console.info("syncing new data",b),a.sync(b[0])}}(this))},a.prototype.remove=function(){},a.prototype.getPrimaryKey=function(){return this.get(this.constructor.primaryKey)},a.list=function(a,b){return"object"!=typeof b&&(b={}),b.data=a,this.firstInterface("list",b).then(function(a){return function(c){var d,e,f,g,h;for(h=[],f=0,g=c.length;g>f;f++)e=c[f],h.push(a.sync(e,b));return d=a._collectionize(h)}}(this))},a.sync=function(a,b){var c;if(c=a[this.primaryKey],!c)throw"You can only sync models with a primary key.";return null==this.index[this.name+"_"+c]?this.index[this.name+"_"+c]=new this.$self(a,b):this.index[this.name+"_"+c].sync(a)},a.prototype.sync=function(a){var b,c,d;a=ConveyorUtil.obj(a);for(c in this.fields)b=this.fields[c],null!=a[c]&&(d=a[c],null!=(null!=b?b.type:void 0)&&(b.type instanceof ConveyorValueCore?this.data[c]=new b.type:null!=ConveyorValue[b.type]?this.data[c]=new ConveyorValue[b.type](d,this,b):console.error("ConveyorModelValue::"+b.type+" is not a valid value type.")),null==this.data[c]&&console.warn("ConveyorModel::constructor ignoring key: ",c,a[c]));return this},a.prototype.$publish=function(a){var b,c;null==a&&(a=!1),c={};for(b in this.data)a?this.data[b].dirty&&(c[b]=this.data[b].$publish()):c[b]=this.data[b].$publish();return c},a.prototype.get=function(a){return this.data[a]?this.data[a].get():null},a.prototype.set=function(a,b){var c;return this.data[a]?this.data[a].set(b):null!=this.fields[a]?(c=this.fields[a],c.type instanceof ConveyorValueCore?this.data[a]=new c.type:null!=ConveyorValue[c.type]?this.data[a]=new ConveyorValue[c.type](b,this,c):console.error("ConveyorModelValue::"+c.type+" is not a valid value type.")):void 0},a.prototype.$facade=function(a){return new ConveyorFacade(this,a)},a._collectionize=function(a){var b;return a.$changed=function(){return this.filter(function(a){return a.dirty})},b=[],a.$facade=function(a){var c,d,e;for(b=[],d=0,e=this.length;e>d;d++)c=this[d],b.push(new ConveyorFacade(c,a));return b},a},a.create=function(a){},a.addInterface=function(a,b){return this.interfaces[a]=b},a.prototype.addInterface=function(a,b){return this.constructor.interfaces[a]=b},a.prototype.allInterfaces=function(){var a,b,d,e,f,g;b=arguments[0],e=2<=arguments.length?c.call(arguments,1):[],f=ConveyorUtil.obj(this.constructor.interfaces),d=[];for(g in f)a=f[g],-1!==a.actions.indexOf(b)&&d.push(a.$$apply(b,e));if(!d.length)throw"No interface available with the ability to: "+b;return ConveyorPromise.aggregate(d)},a.firstInterface=function(){var a,b,d,e;b=arguments[0],d=2<=arguments.length?c.call(arguments,1):[];for(e in this.interfaces)if(a=this.interfaces[e],-1!==a.actions.indexOf(b))return a.$$apply(b,d);throw"No interface available with the ability to: "+b},a.prototype.fields={},a.primaryKey="id",a.index={},a}(),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorModel=a}.call(this),function(){var a,b;a=function(){function a(a){this.changed=!1,this.timestamp=Date.now()}return a.prototype.undo=function(){},a}(),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorModelState=a}.call(this),function(){var a,b,c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;c=function(){function b(a,b,c){this.model=b,this.conf=c,this.current=null,this.dirty=!1,this.saved=!1,this.errors=[],this.history=[],this.$apply(a,!0)}return b.transformers=[],b.prototype.get=function(){return this.current},b.prototype.set=function(a){return this.$apply(a)},b.onApply=function(a){var b;return b=Conveyor.Transformer(a),this.transformers.length?this.transformers.push(b):this.transformers=[b]},b.onPublish=function(a){var b;return b=Conveyor.Transformer(null,a),this.transformers.length?this.transformers.push(b):this.transformers=[b]},b.prototype.$apply=function(a,c){var d;return null==c&&(c=!1),this.raw=a,d=this.current,ConveyorBelt.run(this,this.constructor.transformers,"apply").then(function(a){return function(e){return e instanceof b?a.current=e.raw:a.current=e,c||a.current===d||(a.dirty=!0),c?a.dirty=!1:void 0}}(this),function(a){return this.exception(a)})},b.prototype.$publish=function(){var a;return a=null,ConveyorBelt.run(this,this.constructor.transformers,"publish").then(function(c){return a=c instanceof b?c.current:c},function(a){return this.exception(a)}),a},b.prototype.exception=function(b){throw console.error(b),new a(b,this)},b}(),b={},b.String=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.onApply(function(a){return"string"==typeof a.raw?this.next(a.raw):a.raw?"boolean"==typeof a.raw?this.next(a.raw&&(a.conf.boolTrue||"1")||a.conf.boolFalse||"0"):null!=a.raw.toString?this.next(a.raw.toString()):a.exception("ConveyorValue.String - Cannot convert value to string."):this.next("")}),b}(c),b.Number=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.onApply(function(a){return"boolean"==typeof a.raw?this.next(a.raw&&1||0):"string"==typeof a.raw?0===a.raw.length?this.next(0):(a.raw.match(/[^0-9$%#,.\s\r\n]/g)&&a.raw.exception("Cannot convert `"+a.raw+"` to a number."),this.next(parseFloat(a.raw.replace(/[^0-9\.]/g,"")))):a.raw instanceof b||"number"==typeof a.raw?this.next(a.raw):a.exception("Cannot convert `"+a.raw+"` to a number.")}),b}(c),b.Currency=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.onApply(function(a){return"boolean"==typeof a.raw?this.next(a.raw&&1||0):"string"==typeof a.raw?0===a.raw.length?this.next(0):(a.raw.match(/[^0-9$%#,.\s\r\n]/g)&&a.raw.exception("Cannot convert `"+a.raw+"` to a number."),this.next(parseFloat(a.raw.replace(/[^0-9\.]/g,"")))):a.raw instanceof Number||"number"==typeof a.raw?this.next(a.raw):a.exception("Cannot convert `"+a.raw+"` to a number.")}),b}(c),b.Boolean=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.onApply(function(a){if("boolean"==typeof a.raw)return this.next(a.raw);if("string"==typeof a.raw){if(-1!==["yes","true","1"].indexOf(a.raw))return this.next(!0);if(-1!==["no","false","0"].indexOf(a.raw))return this.next(!1)}return"number"==typeof a.raw?this.next(0!==a.raw&&!0||!1):a.exception("Cannot convert `"+a.raw+"` to a boolean.")}),b}(c),b.Model=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.onApply(function(a){return"object"==typeof a.raw?this.next(new a.conf.model(a.raw)):this.next(a.raw)}),b}(c),a=function(){function a(a,b){this.message=a,this.value=b}return a}(),d="undefined"!=typeof exports&&null!==exports?exports:window,d.ConveyorValueCore=c,d.ConveyorValue=b}.call(this),function(){var a;a=function(){function a(a,b){this._ref=this.constructor.index++,"function"==typeof a?this.executor=a:this.executor=null,this.resolvers=[],this.rejecters=[],this.$list=[],this.next=null,this.status=0,this.value=null,b||"function"!=typeof a||this.run()}return a.index=0,a.prototype.then=function(b,c){var d,e;return b instanceof a&&(e=b,c=function(a){return e.reject(a)},b=function(a){return e.resolve(a)}),0===this.status?(d=new a,b&&(b.$promise=d,this.resolvers.push(b)),c&&(c.$promise=d,this.rejecters.push(c)),d):1===this.status&&b?this._next(b.call(this,this.value)):-1===this.status&&c?this._next(c.call(this,this.value)):this},a.prototype["catch"]=function(a){return-1===this.status&&a&&a.call(this,value),a&&this.rejecters.push(a),this},a.resolve=function(b){var c;return c=new a,c.status=1,c.value=b,c},a.reject=function(b){var c;return c=new a,c.status=-1,c.value=b,c},a.prototype.resolve=function(a){var b,c,d,e,f;if(0!==this.status)throw console.error("test"),"This promise is already "+(-1===this.status&&"rejected"||"resolved")+". Cannot resolve.";for(this.value=a,this.status=1,f=this.resolvers,c=0,d=f.length;d>c;c++)b=f[c],e=b.call(this,a),null!=b.$promise&&b.$promise._forward(e);return this},a.prototype.reject=function(a){var b,c,d,e,f;if(0!==this.status)throw"This promise is already "+(-1===this.status&&"rejected"||"resolved")+". Cannot reject.";for(this.value=a,this.status=-1,f=this.rejecters,c=0,d=f.length;d>c;c++)b=f[c],e=b.call(this,a),null!=b.$promise&&b.$promise._forward(e);return this},a.prototype.run=function(a){if("function"==typeof executor&&(this.executor=executor),"function"!=typeof this.executor)throw"You can only call run on a promise if an executor is provided.";return this.executor.call(this,this.resolve,this.reject)},a.aggregate=function(b,c){var d,e,f,g,h,i,j,k,l,m;for(null==c&&(c=!1),d=new a,f=0,m=b.length,g=[],i=function(){return f++,f===m?e():void 0},e=function(){var a,e,f,g,h,i;for(h=[],a=[],e=f=0,g=b.length;g>f;e=++f)i=b[e],1===i.status?h.push(i.value):a.push(i.value);return a.length&&!h.length?d.reject(a):a.length&&c?d.reject(a):d.resolve(h)},h=j=0,k=b.length;k>j;h=++j)l=b[h],l.then(i,i);return d},a.prototype._forward=function(b){return b instanceof a?b.then(function(a){return function(b){return a.resolve(b)}}(this),function(a){return this.reject(a)}):this.resolve(b)},a.prototype._next=function(b){return b instanceof a?b:a.resolve(b)},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorPromise=a}.call(this);