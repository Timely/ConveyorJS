(function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;b=function(){function a(){}return a.prototype._arrayForEach=function(a,b){if(!Array.isArray(a))throw"_arrayForEach expects an array, given: "+typeof a;return a.length},a.makePromise=function(a){return a.prototype.__pr_util=function(){return null==this._resolvers&&(this._resolvers=[]),null==this._rejecters?this._rejecters=[]:void 0},a.prototype.resolve=function(){var a,b,c,d,e;for(this.__pr_util(),d=this._resolvers,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.apply(this,arguments));return e},a.prototype.reject=function(){var a,b,c,d,e;for(this.__pr_util(),d=this._rejecters,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.apply(this,arguments));return e},a.prototype.then=function(a,b){return this.__pr_util(),a&&this._resolvers.push(a),b&&this._rejecters.push(b),this},a.prototype["catch"]=function(a){return this.__pr_util(),a&&this._rejecters.push(a),this}},a}(),a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype._setDefaults=function(a,b){var c,d;if("object"==typeof b)for(d in b)a[d]=b[d];c=[];for(d in a)c.push(this[d]=a[d]);return c},b}(b),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorBase=a,("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorUtil=b}).call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=function(a){function b(a){this.options=a}return c(b,a),b.prototype.save=function(a){var b,c;return c=a.state.snapshot(),b=new ConveyorBelt("publish",this.transformers,c),b.promise},b.prototype.$remove=function(){},b.prototype.$list=function(){},b.prototype.$create=function(){},b}(ConveyorBase),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorInterface=a}.call(this),function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty;a=function(a){function b(a){this._setDefaults({_applier:null,models:{},_publisher:null}),a&&(a.onApply&&(this._applier=a.onApply),a.onPublish&&(this._publisher=a.onPublish))}return c(b,a),b.prototype.onApply=function(a){return this._applier=a,this},b.prototype.onPublish=function(a){return this._publisher=a,this},b.prototype.$apply=function(a,b){return this._applier?this._applier.call(b,a):void 0},b.prototype.$publish=function(a,b){return this._publisher?this._publisher.call(b,a):void 0},b}(ConveyorBase),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorTransformer=a}.call(this),function(){var a;a=function(){function a(a,b,c){this.promise=new ConveyorPromise,this.data=a,this.transformers=b,this.direction=c||"apply",this.pos=-1,this.status=-1,this.error=!1,this.warnings=[],this.next(this.data)}return a.prototype.next=function(a){return this.data=a,this.pos++,this.status=0,this.pos<this.transformers.length?this.transformers[this.pos]["$"+this.direction](this.data,this):(this.status=1,this.promise.resolve(a)),this},a.prototype.reject=function(a){return this.promise.reject(a)},a.prototype.skip=function(){return this.next(this.data)},a.prototype.warn=function(a){return this.warnings.push(a)},a.prototype.later=function(a){},a.prototype.inject=function(a){return this.transformers.splice(this.pos+1,0,a),this},a.prototype.append=function(a){return this.transformers.push(a),this},a.run=function(b,c,d){return new a(b,c,d).promise},a.thread=function(b,c,d){var e,f,g,h;for(h=[],f=0,g=b.length;g>f;f++)e=b[f],h.push(new a(e,c,d).promise);return ConveyorPromise.aggregate(h)},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorBelt=a}.call(this),function(){var a;a=function(){function a(){}return a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorConflict=a}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(){this._setDefaults({transformers:{},models:{},interfaces:{}})}return b(c,a),c.prototype.registerTransformer=function(a){return this.transformers[a]=new ConveyorTransformer},c.prototype.registerModel=function(){},c.prototype.registerInterface=function(){},c}(ConveyorBase),("undefined"!=typeof exports&&null!==exports?exports:this).Conveyor=a}.call(this),function(){var a;a=function(){function a(){}return a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorFacade=a}.call(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){function c(a){this._setDefaults({endpoint:null,actions:[],transformers:[],listTransformers:[]},a)}return b(c,a),c.prototype.fetch=function(){},c.prototype.remove=function(){},c.prototype.list=function(a){var b,c;return c=new ConveyorPromise,b=this.endpoint,this._req("get",b,a).then(function(a){return function(b){return ConveyorBelt.run(b,a.listTransformers,"apply").then(function(d){if(d instanceof Array)return ConveyorBelt.thread(b,a.transformers,"apply").then(c);throw"list must be array"},c.reject)}}(this),function(a,b,d){return c.reject(d)}),c},c.prototype.save=function(a){},c.prototype._buildPath=function(){},c.prototype._req=function(a,b,c){return $.ajax({url:b,method:a,data:c})},c}(ConveyorInterface),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorHttpInterface=a}.call(this),function(){var a,b;a=function(){function a(a){this._ref=this.constructor._refCount++,this.data={},this.interfaces={},this.sync(a)}return a._refCount=0,a.prototype.save=function(){},a.prototype.remove=function(){},a.list=function(a){return this.firstInterface("list").list(a).then(function(a){return function(b){var c,d,e,f,g;for(g=[],d=0,f=b.length;f>d;d++)e=b[d],g.push(a.sync(e));return c=a._collectionize(g)}}(this))},a.sync=function(a){var b;if(b=a[this.primaryKey],!b)throw"You can only sync models with a primary key.";return null==this.index[this.name+"_"+b]?this.index[this.name+"_"+b]=new this.$self(a):this.index[this.name+"_"+b].sync(a)},a.prototype.sync=function(a){var b,c,d;for(c in a)d=a[c],b=this.fields[c],null!=b&&null!=ConveyorValue[b.type]&&(this.data[c]=new ConveyorValue[b.type](d,this,b)),null==this.data[c]&&console.warn("ConveyorModel::constructor ignoring key: ",c,a[c]);return this},a.prototype.get=function(a){return this.data[a]?this.data[a].get():null},a.prototype.set=function(a,b){return this.data[a]?this.data[a].set(b):null},a._collectionize=function(a){return a.$changed=function(){return this.filter(function(a){return a.dirty})},a},a.create=function(a){},a.addInterface=function(a,b){return this.interfaces[a]=b},a.prototype.addInterface=function(a,b){return this.interfaces[a]=b},a.firstInterface=function(a){var b,c;for(c in this.interfaces)if(b=this.interfaces[c],-1!==b.actions.indexOf(a))return b;throw"No interface available with the ability to: "+a},a.prototype.fields={},a.primaryKey="id",a.index={},a}(),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorModel=a}.call(this),function(){var a,b;a=function(){function a(a){this.changed=!1,this.timestamp=Date.now()}return a.prototype.undo=function(){},a}(),b="undefined"!=typeof exports&&null!==exports?exports:window,b.ConveyorModelState=a}.call(this),function(){var a,b,c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;c=function(){function b(a,b,c){this.model=b,this.conf=c,this.current=null,this.dirty=!1,this.saved=!1,this.errors=[],this.history=[],this.$apply(a,!0)}return b.transformers=[],b.prototype.get=function(){var a;return a=null,this.$publish().then(function(b){return console.log("got",b),a=b}),a},b.prototype.set=function(a){return this.$apply(a)},b.prototype.$apply=function(a,c){var d;return null==c&&(c=!1),this.raw=a,d=this.current,console.info("$apply",a),ConveyorBelt.run(this,this.constructor.transformers,"apply").then(function(a){return function(e){return console.info("$applied",e),e instanceof b?a.current=e.raw:a.current=e,c||a.current===d||(a.dirty=!0),c?a.dirty=!1:void 0}}(this),function(a){return this.exception(a)})},b.prototype.$publish=function(){return ConveyorBelt.run(this,this.constructor.transformers,"publish").then(function(a){return console.info("$publish",a),a instanceof b?a.current:a},function(a){return this.exception(a)})},b.prototype.exception=function(b){throw console.error(b),new a(b,this)},b}(),b={},b.String=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.transformers=[(new ConveyorTransformer).onApply(function(a){return"string"==typeof a.raw?this.next(a.raw):a.raw?"boolean"==typeof a.raw?this.next(a.raw&&(a.conf.boolTrue||"1")||a.conf.boolFalse||"0"):null!=a.raw.toString?this.next(a.raw.toString()):a.exception("ConveyorValue.String - Cannot convert value to string."):this.next("")})],b}(c),b.Number=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.transformers=[(new ConveyorTransformer).onApply(function(a){return"boolean"==typeof a.raw?this.next(a.raw&&1||0):"string"==typeof a.raw?0===a.raw.length?this.next(0):(a.raw.match(/[^0-9$%#,.\s\r\n]/g)&&a.raw.exception("Cannot convert `"+a.raw+"` to a number."),this.next(parseFloat(a.raw.replace(/[^0-9\.]/g,"")))):a.raw instanceof b||"number"==typeof a.raw?this.next(a.raw):a.exception("Cannot convert `"+a.raw+"` to a number.")})],b}(c),b.Boolean=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.transformers=[(new ConveyorTransformer).onApply(function(a){if("boolean"==typeof a.raw)return this.next(a.raw);if("string"==typeof a.raw){if(-1!==["yes","true","1"].indexOf(a.raw))return this.next(!0);if(-1!==["no","false","0"].indexOf(a.raw))return this.next(!1)}return"number"==typeof a.raw?this.next(0!==a.raw&&!0||!1):a.exception("Cannot convert `"+a.raw+"` to a boolean.")})],b}(c),a=function(){function a(a,b){this.message=a,this.value=b}return a}(),d="undefined"!=typeof exports&&null!==exports?exports:window,d.ConveyorValue=b}.call(this),function(){var a;a=function(){function a(a,b){this._ref=this.constructor.index++,"function"==typeof a?this.executor=a:this.executor=null,this.resolvers=[],this.rejecters=[],this.next=null,this.status=0,this.value=null,b||"function"!=typeof a||this.run()}return a.index=0,a.prototype.then=function(b,c){var d,e;return b instanceof a&&(e=b,c=function(a){return e.reject(a)},b=function(a){return e.resolve(a)}),0===this.status?(d=new a,b&&(b.$promise=d,this.resolvers.push(b)),c&&(c.$promise=d,this.rejecters.push(c)),d):1===this.status&&b?this._next(b.call(this,this.value)):-1===this.status&&c?this._next(c.call(this,this.value)):this},a.prototype["catch"]=function(a){return-1===this.status&&a&&a.call(this,value),a&&this.rejecters.push(a),this},a.resolve=function(b){var c;return c=new a,c.status=1,c.value=b,c},a.reject=function(b){var c;return c=new a,c.status=-1,c.value=b,c},a.prototype.resolve=function(a){var b,c,d,e,f;if(0!==this.status)throw"This promise is already "+(-1===this.status&&"rejected"||"resolved")+". Cannot resolve.";for(this.value=a,this.status=1,f=this.resolvers,c=0,d=f.length;d>c;c++)b=f[c],e=b.call(this,a),null!=b.$promise&&b.$promise._forward(e);return this},a.prototype.reject=function(a){var b,c,d,e,f;if(0!==this.status)throw"This promise is already "+(-1===this.status&&"rejected"||"resolved")+". Cannot reject.";for(this.value=a,this.status=-1,f=this.rejecters,c=0,d=f.length;d>c;c++)b=f[c],e=b.call(this,a),null!=b.$promise&&b.$promise._forward(e);return this},a.prototype.run=function(a){if("function"==typeof executor&&(this.executor=executor),"function"!=typeof this.executor)throw"You can only call run on a promise if an executor is provided.";return this.executor.call(this,this.resolve,this.reject)},a.aggregate=function(b,c){var d,e,f,g,h,i,j,k,l,m;for(null==c&&(c=!1),d=new a,f=0,m=b.length,g=[],i=function(){return f++,f===m?e():void 0},e=function(){var a,e,f,g,h,i;for(h=[],a=[],e=f=0,g=b.length;g>f;e=++f)i=b[e],1===i.status?h.push(i.value):a.push(i.value);return a.length&&!h.length?d.reject(a):a.length&&c?d.reject(a):d.resolve(h)},h=j=0,k=b.length;k>j;h=++j)l=b[h],l.then(i,i);return d},a.prototype._forward=function(b){return b instanceof a?b.then(function(a){return function(b){return a.resolve(b)}}(this),function(a){return this.reject(a)}):this.resolve(b)},a.prototype._next=function(b){return b instanceof a?b:a.resolve(b)},a}(),("undefined"!=typeof exports&&null!==exports?exports:this).ConveyorPromise=a}.call(this);